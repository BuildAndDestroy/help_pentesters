#!/usr/bin/env python3
"""Modified ippsec tool from the Sharp video

https://youtu.be/lxjAZELJ96Q?t=1757
"""

import argparse
from base64 import b64decode

import des


def decode_b64_password(password) -> str:
    """User supplied password, must be base64"""
    passwd = b64decode(password)
    return passwd


def decrypt_password(secret, initialization_vector, user_provided_password) -> str:
    """Decrypt password"""
    secret = des.DesKey(b'{secret}')
    initialization_vector = b'{initialization_vector}'
    return secret.decrypt(user_provided_password, initial=initialization_vector, padding=True)


def argument_parser() -> tuple():
    """User input to parse in script"""
    knowledge_article = 'Youtube video for Sharp: https://youtu.be/lxjAZELJ96Q?t=1757'
    parser = argparse.ArgumentParser(
        description=__doc__, epilog=knowledge_article, formatter_class=argparse.RawTextHelpFormatter)
    parser.add_argument('password', help='Base64 Password to decrypt')
    parser.add_argument('secret', help='Secret used to encrypt password')
    parser.add_argument('initialization_vector',
                        help='IV used in conjuction with secret to encrypt password')
    args = parser.parse_args()
    return args


def main() -> None:
    """Execute this script"""
    args = argument_parser()
    user_provided_password = decode_b64_password(args.password)
    print(decrypt_password(args.secret,
                           args.initialization_vector, user_provided_password))


if __name__ == '__main__':
    main()
